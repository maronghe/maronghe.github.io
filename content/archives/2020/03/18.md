



创建路径/data本地：

`mkdir -p /Users/logan/dev/workspace/mysql-docker/data3307`

`mkdir -p /Users/logan/dev/workspace/mysql-docker/data3308`

创建配置文件：

`vim /Users/logan/dev/workspace/mysql-docker/my3307.cnf`

```mysql
# msyql 3307的配置：
[mysqld]
pid-file	= /var/run/mysqld/mysqld.pid
socket		= /var/run/mysqld/mysqld.sock
datadir		= /var/lib/mysql
server-id = 1
log_bin = mysql-bin
binlog_format = ROW
expire_logs_days = 30
```

`vim /Users/logan/dev/workspace/mysql-docker/my3308.cnf`

```mysql
# msyql 3308的配置：
[mysqld]
pid-file	= /var/run/mysqld/mysqld.pid
socket		= /var/run/mysqld/mysqld.sock
datadir		= /var/lib/mysql
server-id = 2
log_bin = mysql-bin
binlog_format = ROW
expire_logs_days = 30
```

创建容器：

```shell
docker run -d -p 3308:3306 -v /Users/logan/dev/workspace/mysql-docker/my3308.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf -v /Users/logan/dev/workspace/mysql-docker/data3308:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql-3308 mysql:5.7

docker run -d -p 3307:3306 -v /Users/logan/dev/workspace/mysql-docker/my3307.cnf:/etc/mysql/mysql.conf.d/mysqld.cnf -v /Users/logan/dev/workspace/mysql-docker/data3307:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql-3307 mysql:5.7
```

连接客户端（创建表）：

```shell
mysql -uroot -h 127.0.0.1 -P3307 -p123456
create database test;
use test;
create table user (
    id int,
    name varchar(10),
    score int
);
insert into user values(1, "foo", 10);
exit;

mysql -uroot -h 127.0.0.1 -P3308 -p123456
create database test;
use test;
create table wallet (
    id int,
    money float 
);
insert into wallet values(1, 10.1);
```

奇怪的问题：当启动一个XA事务的时候，一直阻塞在执行任务的命令上。

![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge8oe8et3rj30z60j0jv4.jpg)

随后查阅资料，

```mysql
SELECT * FROM `information_schema`.`innodb_trx` ORDER BY `trx_started`;
```

发现有正在进行中的事务，但是kill不掉，recover xa; 看到有为提交的xaid。

![](https://tva1.sinaimg.cn/large/007S8ZIlly1ge8oddprx5j31do0rmkjl.jpg)

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8pbzduq4j30qs06kdlu.jpg)

`xa commit 1587995602; 

![](https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8pbifwhbj30ly03s41g.jpg)

提交后之后就好了。