<!DOCTYPE html>
<html>
  <head>
  <title>
      
          #2 [采坑指南] json.Unmarshal后interface{}成map[string]interface{} - LoganMa&#39;s Blog
      
  </title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="马荣贺(Logan Ma)" />
  <link rel="shortcut icon" type="image/x-icon" href="https://maronghe.github.io/img/horseface.ico">

  
  
  
  
  
  <link rel="stylesheet" href="https://maronghe.github.io/style.min.a50e85be2191b7446e684667eb002377b10f833f329c30d9b701ea188a664750.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

  
  

  <meta property="og:title" content="#2 [采坑指南] json.Unmarshal后interface{}成map[string]interface{}" />
<meta property="og:description" content="​ 可能大家工作中都会遇到类型断言，即接口类型断言是否为某种strcut类型i.(A)或某种struct的指针类型i.(*A)。 那么当一个想要" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://maronghe.github.io/archives/2020/03/2/" />
<meta property="article:published_time" content="2020-03-29T23:43:01+08:00" />
<meta property="article:modified_time" content="2020-03-29T23:43:01+08:00" />
<meta itemprop="name" content="#2 [采坑指南] json.Unmarshal后interface{}成map[string]interface{}">
<meta itemprop="description" content="​ 可能大家工作中都会遇到类型断言，即接口类型断言是否为某种strcut类型i.(A)或某种struct的指针类型i.(*A)。 那么当一个想要">
<meta itemprop="datePublished" content="2020-03-29T23:43:01&#43;08:00" />
<meta itemprop="dateModified" content="2020-03-29T23:43:01&#43;08:00" />
<meta itemprop="wordCount" content="627">



<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:image" content="https://maronghe.github.io//img/loganma.jpeg"/>
<meta name="twitter:title" content="#2 [采坑指南] json.Unmarshal后interface{}成map[string]interface{}"/>
<meta name="twitter:description" content="​ 可能大家工作中都会遇到类型断言，即接口类型断言是否为某种strcut类型i.(A)或某种struct的指针类型i.(*A)。 那么当一个想要"/>

  <!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
  <![endif]-->

  </head>

  <body>
    
  <h1>#2 [采坑指南] json.Unmarshal后interface{}成map[string]interface{}</h1>
  <header>
  
  <div class="avatar">
    <img class="avatarMask" src="https://maronghe.github.io//img/loganma.jpeg">
    <a href="https://maronghe.github.io/"><img src="https://maronghe.github.io//img/avatar-border.svg"></a>
  </div>
  
  <h2><a class="author" href="https://maronghe.github.io/">马荣贺(Logan Ma)</a></h2>
</header>

  
  
  <p class="date">March 29, 2020</p>
  
  <div id="tags">
    <ul>
      
    </ul>
  </div>
  
  <div id="contentBody">
    <p>​	可能大家工作中都会遇到类型断言，即接口类型断言是否为某种strcut类型<code>i.(A)</code>或某种struct的指针类型<code>i.(*A)</code>。</p>
<p>那么当一个想要一个<code>interface{}</code>类型既想转换成多种类型，且多种类型并不属于同一种。这句话说的可能比较绕圈，下面举个例子来看下。</p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdbs3lnvfqj30sm0humz9.jpg" alt=""></p>
<p>当有两个SA和SB，当我们想要从字符串翻转成结构体时。我们可以</p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdbs4kh13cj30xq0icq4o.jpg" alt=""></p>
<p>没问题，输出结果是</p>
<pre><code>sa {logan 18 Beijing}
PASS
</code></pre><p>但是当结构体内容时由其他结构体，以<code>interface{}</code>类型进行返回时，那么情景可能如下。</p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdbs52mbhoj30kk05qdgc.jpg" alt=""></p>
<p><img src="https://tva1.sinaimg.cn/large/00831rSTgy1gdbs5kk96wj30u00x4wm8.jpg" alt=""></p>
<p>如果50和51行都注释掉了的话，那么结果会输出</p>
<pre><code>it2 data type is map[string]interface {}
ti3 type assertion error, it isn't type SA 
ti4 type assertion error, it isn't type SB
ti5 is map[addr:Beijing age:18 name:logan]
PASS
</code></pre><p>意味着data转换成了<code>map[string]interface{}</code>如果转换成<code>map[string]interface{}</code>类型后，那么想要key中的value还需要继续类型断言。</p>
<p><strong>为什么会转成<code>map[string]interface{}</code>呢？因为对象底层类型，当<code>unmarshal</code>时并不知道对象底层类型。</strong></p>
<p>那么，是否有一种希望转成的类型当我们的确希望转换成某种类型，如SA或SB。</p>
<p>答案是需要告诉结构类型的底层类型是什么，才可做此类型的类型断言。</p>
<p>解开注释50或51行后，则输出结果成为</p>
<pre><code>it2 data type is *main.SB
ti3 type assertion error, it isn't type SA 
ti4 is &amp;{logan 18 } 
ti5 type assertion error, it isn't type map[string]interface{} 
PASS
</code></pre><p>总结：当我们希望类型断言的结构体中是一个<code>interface{}</code>类型时，希望转换成某种我们希望的类型，要进行底层类型的转换。那么就要给Data进行赋值类型。则断言方可成功。</p>
<blockquote>
<p>参考内容</p>
</blockquote>
<ol>
<li><a href="https://github.com/maronghe/todo-list/issues/5">https://github.com/maronghe/todo-list/issues/5</a></li>
<li><a href="https://stackoverflow.com/questions/43325288/golang-convert-interface-to-struct/43325450">https://stackoverflow.com/questions/43325288/golang-convert-interface-to-struct/43325450</a></li>
<li><a href="https://play.golang.org/p/6fOr0rFV_e1">https://play.golang.org/p/6fOr0rFV_e1</a></li>
</ol>

  </div>
  <footer>
  <p>
  &copy; 2020 马荣贺(Logan Ma).
  </p>
</footer>


  </body>
</html>
